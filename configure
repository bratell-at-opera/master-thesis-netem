#!/bin/bash

function printHelp {
    if [ -n "$2" ]; then
        echo "ERROR: $2"
        echo ""
    fi
    echo 
    echo "Usage:"
    echo "  $1 [-e interface|--external-if=interface]"
    echo ""
    echo "-e|--external-if"
    echo "      External interface for communicating with the outside world. Usually your primary network interface"
    exit 1
}

netemFolder=$(realpath $(dirname $0))
certFolder=$netemFolder/certs
configFolder=$netemFolder/config

# Handle in-arguments
externalIf=false

while [[ $# -gt 0 ]] && [[ ."$1" = .--* ]] ;
do
    opt="$1";
    shift;              #expose next argument
    case "$opt" in
        "--" ) break 2;;
        "-c"|"--no-certs")
            noCerts=true
            ;;
        "--e")
            externalIf="$1"
            shift
            ;;
        "--external-if=*")
            externalIf="${opt#*=}"
            ;;
        *) echo >&2 "Invalid option: $@"; exit 1;;
    esac
done

if [ "$externalIf" = false ]; then
    printHelp $0 "Please choose an external interface!"
fi

# Create log folder
logFolder=$netemFolder/logs
mkdir -p $logFolder

# -------------------- Virtual network setup
# Setup network namespaces and infrastructure
echo "Setting up virtual network infrastructure. Will ask for password in order to gain root access."
sudo $netemFolder/net-setup/net-setup.bash

